"use strict";

/**
 * @license
 * Copyright 2015 Petr Shevtsov (petr.shevtsov@gmail.com)
 * MIT-licenced: https://opensource.org/licenses/MIT
 */

/*global Dygraph:false */
/*jshint globalstrict: true */
Dygraph.Plugins.Crosshair = function () {
  "use strict";

  /**
   * Creates the crosshair
   *
   * @constructor
   */
  var crosshair = function crosshair(opt_options) {
    this.canvas_ = document.createElement("canvas");
    opt_options = opt_options || {};
    this.direction_ = opt_options.direction || null;
    this.strokeStyle_ = opt_options.strokeStyle || "rgba(0, 0, 0, 0.3)";
  };
  crosshair.prototype.toString = function () {
    return "Crosshair Plugin";
  };

  /**
   * @param {Dygraph} g Graph instance.
   * @return {object.<string, function(ev)>} Mapping of event names to callbacks.
   */
  crosshair.prototype.activate = function (g) {
    g.graphDiv.appendChild(this.canvas_);
    return {
      select: this.select,
      deselect: this.deselect
    };
  };
  crosshair.prototype.select = function (e) {
    if (this.direction_ === null) {
      return;
    }
    var width = e.dygraph.width_;
    var height = e.dygraph.height_;
    this.canvas_.width = width;
    this.canvas_.height = height;
    this.canvas_.style.width = width + "px"; // for IE
    this.canvas_.style.height = height + "px"; // for IE

    var ctx = this.canvas_.getContext("2d");
    ctx.clearRect(0, 0, width, height);
    ctx.strokeStyle = this.strokeStyle_;
    ctx.beginPath();
    var canvasx = Math.floor(e.dygraph.selPoints_[0].canvasx) + 0.5; // crisper rendering

    if (this.direction_ === "vertical" || this.direction_ === "both") {
      ctx.moveTo(canvasx, 0);
      ctx.lineTo(canvasx, height);
    }
    if (this.direction_ === "horizontal" || this.direction_ === "both") {
      for (var i = 0; i < e.dygraph.selPoints_.length; i++) {
        var canvasy = Math.floor(e.dygraph.selPoints_[i].canvasy) + 0.5; // crisper rendering
        ctx.moveTo(0, canvasy);
        ctx.lineTo(width, canvasy);
      }
    }
    ctx.stroke();
    ctx.closePath();
  };
  crosshair.prototype.deselect = function (e) {
    var ctx = this.canvas_.getContext("2d");
    ctx.clearRect(0, 0, this.canvas_.width, this.canvas_.height);
  };
  crosshair.prototype.destroy = function () {
    this.canvas_ = null;
  };
  return crosshair;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEeWdyYXBoIiwiUGx1Z2lucyIsIkNyb3NzaGFpciIsImNyb3NzaGFpciIsIm9wdF9vcHRpb25zIiwiY2FudmFzXyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImRpcmVjdGlvbl8iLCJkaXJlY3Rpb24iLCJzdHJva2VTdHlsZV8iLCJzdHJva2VTdHlsZSIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiYWN0aXZhdGUiLCJnIiwiZ3JhcGhEaXYiLCJhcHBlbmRDaGlsZCIsInNlbGVjdCIsImRlc2VsZWN0IiwiZSIsIndpZHRoIiwiZHlncmFwaCIsIndpZHRoXyIsImhlaWdodCIsImhlaWdodF8iLCJzdHlsZSIsImN0eCIsImdldENvbnRleHQiLCJjbGVhclJlY3QiLCJiZWdpblBhdGgiLCJjYW52YXN4IiwiTWF0aCIsImZsb29yIiwic2VsUG9pbnRzXyIsIm1vdmVUbyIsImxpbmVUbyIsImkiLCJsZW5ndGgiLCJjYW52YXN5Iiwic3Ryb2tlIiwiY2xvc2VQYXRoIiwiZGVzdHJveSJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leHRyYXMvY3Jvc3NoYWlyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE1IFBldHIgU2hldnRzb3YgKHBldHIuc2hldnRzb3ZAZ21haWwuY29tKVxuICogTUlULWxpY2VuY2VkOiBodHRwczovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICovXG5cbi8qZ2xvYmFsIER5Z3JhcGg6ZmFsc2UgKi9cbi8qanNoaW50IGdsb2JhbHN0cmljdDogdHJ1ZSAqL1xuRHlncmFwaC5QbHVnaW5zLkNyb3NzaGFpciA9IChmdW5jdGlvbigpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgdGhlIGNyb3NzaGFpclxuICAgKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG5cbiAgdmFyIGNyb3NzaGFpciA9IGZ1bmN0aW9uKG9wdF9vcHRpb25zKSB7XG4gICAgdGhpcy5jYW52YXNfID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBvcHRfb3B0aW9ucyA9IG9wdF9vcHRpb25zIHx8IHt9O1xuICAgIHRoaXMuZGlyZWN0aW9uXyA9IG9wdF9vcHRpb25zLmRpcmVjdGlvbiB8fCBudWxsO1xuICAgIHRoaXMuc3Ryb2tlU3R5bGVfID0gb3B0X29wdGlvbnMuc3Ryb2tlU3R5bGUgfHwgXCJyZ2JhKDAsIDAsIDAsIDAuMylcIjtcbiAgfTtcblxuICBjcm9zc2hhaXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFwiQ3Jvc3NoYWlyIFBsdWdpblwiO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAcGFyYW0ge0R5Z3JhcGh9IGcgR3JhcGggaW5zdGFuY2UuXG4gICAqIEByZXR1cm4ge29iamVjdC48c3RyaW5nLCBmdW5jdGlvbihldik+fSBNYXBwaW5nIG9mIGV2ZW50IG5hbWVzIHRvIGNhbGxiYWNrcy5cbiAgICovXG4gIGNyb3NzaGFpci5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbihnKSB7XG4gICAgZy5ncmFwaERpdi5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhc18pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbGVjdDogdGhpcy5zZWxlY3QsXG4gICAgICBkZXNlbGVjdDogdGhpcy5kZXNlbGVjdFxuICAgIH07XG4gIH07XG5cbiAgY3Jvc3NoYWlyLnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMuZGlyZWN0aW9uXyA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciB3aWR0aCA9IGUuZHlncmFwaC53aWR0aF87XG4gICAgdmFyIGhlaWdodCA9IGUuZHlncmFwaC5oZWlnaHRfO1xuICAgIHRoaXMuY2FudmFzXy53aWR0aCA9IHdpZHRoO1xuICAgIHRoaXMuY2FudmFzXy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgdGhpcy5jYW52YXNfLnN0eWxlLndpZHRoID0gd2lkdGggKyBcInB4XCI7ICAgIC8vIGZvciBJRVxuICAgIHRoaXMuY2FudmFzXy5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7ICAvLyBmb3IgSUVcblxuICAgIHZhciBjdHggPSB0aGlzLmNhbnZhc18uZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5zdHJva2VTdHlsZV87XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gICAgdmFyIGNhbnZhc3ggPSBNYXRoLmZsb29yKGUuZHlncmFwaC5zZWxQb2ludHNfWzBdLmNhbnZhc3gpICsgMC41OyAvLyBjcmlzcGVyIHJlbmRlcmluZ1xuXG4gICAgaWYgKHRoaXMuZGlyZWN0aW9uXyA9PT0gXCJ2ZXJ0aWNhbFwiIHx8IHRoaXMuZGlyZWN0aW9uXyA9PT0gXCJib3RoXCIpIHtcbiAgICAgIGN0eC5tb3ZlVG8oY2FudmFzeCwgMCk7XG4gICAgICBjdHgubGluZVRvKGNhbnZhc3gsIGhlaWdodCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGlyZWN0aW9uXyA9PT0gXCJob3Jpem9udGFsXCIgfHwgdGhpcy5kaXJlY3Rpb25fID09PSBcImJvdGhcIikge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmR5Z3JhcGguc2VsUG9pbnRzXy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgY2FudmFzeSA9IE1hdGguZmxvb3IoZS5keWdyYXBoLnNlbFBvaW50c19baV0uY2FudmFzeSkgKyAwLjU7IC8vIGNyaXNwZXIgcmVuZGVyaW5nXG4gICAgICAgIGN0eC5tb3ZlVG8oMCwgY2FudmFzeSk7XG4gICAgICAgIGN0eC5saW5lVG8od2lkdGgsIGNhbnZhc3kpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHguY2xvc2VQYXRoKCk7XG4gIH07XG5cbiAgY3Jvc3NoYWlyLnByb3RvdHlwZS5kZXNlbGVjdCA9IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgY3R4ID0gdGhpcy5jYW52YXNfLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzXy53aWR0aCwgdGhpcy5jYW52YXNfLmhlaWdodCk7XG4gIH07XG5cbiAgY3Jvc3NoYWlyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jYW52YXNfID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gY3Jvc3NoYWlyO1xufSkoKTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQUEsT0FBTyxDQUFDQyxPQUFPLENBQUNDLFNBQVMsR0FBSSxZQUFXO0VBQ3RDLFlBQVk7O0VBRVo7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUVFLElBQUlDLFNBQVMsR0FBRyxTQUFaQSxTQUFTLENBQVlDLFdBQVcsRUFBRTtJQUNwQyxJQUFJLENBQUNDLE9BQU8sR0FBR0MsUUFBUSxDQUFDQyxhQUFhLENBQUMsUUFBUSxDQUFDO0lBQy9DSCxXQUFXLEdBQUdBLFdBQVcsSUFBSSxDQUFDLENBQUM7SUFDL0IsSUFBSSxDQUFDSSxVQUFVLEdBQUdKLFdBQVcsQ0FBQ0ssU0FBUyxJQUFJLElBQUk7SUFDL0MsSUFBSSxDQUFDQyxZQUFZLEdBQUdOLFdBQVcsQ0FBQ08sV0FBVyxJQUFJLG9CQUFvQjtFQUNyRSxDQUFDO0VBRURSLFNBQVMsQ0FBQ1MsU0FBUyxDQUFDQyxRQUFRLEdBQUcsWUFBVztJQUN4QyxPQUFPLGtCQUFrQjtFQUMzQixDQUFDOztFQUVEO0FBQ0Y7QUFDQTtBQUNBO0VBQ0VWLFNBQVMsQ0FBQ1MsU0FBUyxDQUFDRSxRQUFRLEdBQUcsVUFBU0MsQ0FBQyxFQUFFO0lBQ3pDQSxDQUFDLENBQUNDLFFBQVEsQ0FBQ0MsV0FBVyxDQUFDLElBQUksQ0FBQ1osT0FBTyxDQUFDO0lBRXBDLE9BQU87TUFDTGEsTUFBTSxFQUFF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